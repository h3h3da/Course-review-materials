# 网络攻防 课堂笔记

## 攻击的三个阶段：
准备-攻击-善后
 防护时间 > 检测时间 + 响应时间
 
## DNS服务端口，协议：
53 UDP，UDP无连接，效率更高

## 扫描技术：
	主机扫描：确定在目标网络上的主机是否可达。这是信息收集的初级阶
	段，其效果直接影响到后续的扫描。常用手段：ICMP Echo扫描、ICMP Sweep扫描、Broadcast ICMP扫描、Non-Echo ICMP扫描
	
    端口扫描：通过连接到目标系统的TCP或UDP端口，来确定哪些端口开放？什么服务正在运行
	
    操作系统探测扫描：识别目标OS类型、版本号等信息，攻击更具针对性
	
    漏洞扫描：探测目标主机存在的漏洞，进行针对性攻击

## 交换式局域网如何进行监听：
	
    x分别向A和B发送ARP包，促使其修改ARP表，
	主机A的ARP表中B为<IPb-MACx>
	主机B的ARP表中A为<IPa-MACx>
	X成为主机A和主机B之间的“中间人”
	
## 如何防范交换式网络监听？
	
    监听ARP包，监听通过交换机或者网关的所有ARP数据包，与预先建立的数据库对比，数据可以存储在本地交换机
	定期探测数据包传送路径，与备份的合法路径对比
	使用SNMP定期轮询ARP表
	
## DRDos的原理？
	
    攻击者伪造源地址为受害者地址的SYN连接请求包发送给大量的被欺骗服务器
	服务器群会向源IP（也就是受害者）发出大量的SYN+ACK或RST包来进行响应
	大量服务器的响应数据包最终在受害者处汇集为洪水
	受害者难以隔离攻击洪水流，并且更难找到洪水流的来源
	
## 如何对抗Dos?
	
    加固操作系统，配置各种参数；
	利用防火墙；
	负载均衡；
	带宽限制和QoS保证

## 如何防御DRDoS?
	
    加强源地址管控，对源地址检查，确保源地址合法。

## PEB & TEB

`TEB（Thread Environment Block，线程环境块）系统在此TEB中保存频繁使用的线程相关的数据。`位于用户地址空间，在比 PEB 所在地址低的地方。进程中的每个线程都有自己的一个TEB。一个进程的所有TEB都以堆栈的方式，存放在从0x7FFDE000开始的线性内存中，每 4KB为一个完整的TEB，不过该内存区域是向下扩展的。在用户模式下，当前线程的TEB位于独立的4KB段，可通过CPU的FS寄存器来访问该段，一般存储在[FS:0]。在用户态下WinDbg中可用命令$thread取得TEB地址。

`PEB（Process Environment Block，进程环境块）存放进程信息，每个进程都有自己的PEB信息。`位于用户地址空间。在Win 2000下，进程环境块的地址对于每个进程来说是固定的，在0x7FFDF000处，这是用户地址空间，所以程序能够直接访问。准确的PEB地址应从系统 的EPROCESS结构的0x1b0偏移处获得，但由于EPROCESS在系统地址空间，访问这个结构需要有ring0的权限。

## SQL注入攻击步骤和防御手段

步骤：
注入点的发现
数据库的类型
猜解表名
猜解字段名
猜解内容
进入管理页面，上传ASP木马

## 什么是缓冲区溢出？

## 缓冲区溢出分类：

## 如何才能成功执行缓冲区溢出？

## shellcode编写要注意哪些？

## SEH结构化异常处理：

## 恶意代码实现的关键技术

### 生存技术

反动态跟踪技术
	禁止跟踪中断
	封锁键盘输入和屏幕显示，破坏跟踪调试工具的运行环境
	检测跟踪法
	指令流队列法和逆指令流法
	
反静态分析技术
	对程序代码分块加密执行：防止反汇编进行分析
	伪指令法(Junk Code)：在指令流中插入“废指令”

加密技术
	信息加密
	数据加密
	程序代码加密

变形技术
	重汇编技术
	压缩技术
	膨胀技术
	伪指令技术：伪指令技术主要是对病毒体插入废指令，例如空指令、跳转到下一指令和压弹栈等
	重编译技术

三线程技术
	指一个恶意代码进程同时开启了三个线程，其中一个为主线程，负责远程控制的工作。另外两个辅助线程是监视线程和守护线程，监视线程负责检查恶意代码程序是否被删除或被停止自启动。守护线程注入其它可执行文件内，与恶意代码进程同步，一旦进程被停止，它就会重新启动该进程，并向主线程提供必要的数据，这样就能保证恶意代码运行的可持续性。

进程注入技术
	操作系统的系统服务和网络服务一般都在系统启动时自动加载。恶意代码程序可将自身嵌入到与这些服务相关的进程中，实现隐藏和启动的目的。这类恶意代码只须安装一次，并可被多个服务加载系统运行时始终保持激活状态。
 
通信隐藏技术
	端口定制技术
	端口复用技术：指利用系统网络打开的端口（如25、80、135和139等）传送数据。
		优点：在保证端口默认服务正常工作的条件下复用，具有很强的欺骗性可欺骗防火墙等安全设备可避过IDS和安全扫描系统等安全工具
	
	通信加密技术
	
	隐蔽通道技术

内核级隐藏

### 攻击技术

反防御技术

端口反向连接技术：指恶意代码攻击的服务端（被控制端）主动连接客户端（控制端），防火墙的访问控制策略是对外向内的控制严，但对内到外的控制松

安全漏洞和缓冲区溢出攻击等混合攻击技术

## 恶意代码防范措施

### 恶意代码的分析方法

静态分析方法
	基于代码特征的分析方法
	基于代码语义的分析方法

动态分析方法
	行为分析法：是利用系统监视工具观察恶意代码运行过程时系统环境的变化，通过分析这些变化判断恶意代码的功能。
	跟踪调试法：是通过跟踪恶意代码执行过程使用的系统函数和指令特征分析恶意代码功能的技术。

### 恶意代码防范措施
